# КриптоПро установка в ALT Linux Regular Gnome (Sisyphus)

## Установка КриптоПРО

Чтобы установить КриптоПро CSP на ALT Linux, выполните следующее:

1. Загрузите архив ПО КриптоПро CSP 5.0 для Linux (x64, rpm) - ALT, RED OS, ROSA по ссылке: https://www.cryptopro.ru/products/csp/downloads **Предварительно требуется регистрация на сайте**
![Изображение с сайта криптопро, как выглядит раздел с скачиванием файла](/cryptopro/load.png)

2. Откройте папку где сохранился архив и распакуйте его вручную: "ПКМ" → "Извлечь" и откройте папку `linux-amd64`

![Меню ПКМ на файле, выделен второй пункт - Извлечь](/cryptopro/extract.png)

3. Откройте Терминал в текущей папке в пустом месте "ПКМ" → "Открыть терминал"

![Меню ПКМ на файле, предпоследний пункт - Open Blackbox Here](/cryptopro/open-terminal.png)

4. Выполните команды
```shell[apt-get]
sudo apt-get update
sudo ./install_gui.sh
```

5. Откроется установщик, нажмите на кнопку `<Далее>`. Перемещаться между блоками можно с помощью кнопки [Tab], стрелочками внутри блоков на клавиатуре [←], [→], [↑], [↓], для подтверждения используйте [Пробел] или [Enter].
![Установщик, приветственный экран](/cryptopro/crypto-install-1.png)

6. Выберите все пакеты для установки, кроме Провайдер КС2. Для выбора используйте пробел, для подтверждения [Enter] или `<Далее>`
![Установщик, меню выбора компонентов для установки](/cryptopro/crypto-install-2.png)

7. Начните установку выбрав `<Установить>`
![Установщик, подтверждение списка компонентов к установке](/cryptopro/crypto-install-3.png)

8. Дождитесь окончания установки и нажмите `<Ok>`
![Установщик, завершение установки пакетов](/cryptopro/crypto-install-4.png)

9. Если была приобретена лицензия отдельно, выберите `<Ввести лицензию>` и введите лицензию, указанную в бланке. Если лицензии нет, либо в сертификате есть встроенная лицензия — выберите `<Позже>`
![Установщик, лицензионный ключ](/cryptopro/crypto-install-5.png)

10. Выберите `<Выход>` и закройте установщик.
![Установщик, главное меню](/cryptopro/crypto-install-6.png)

Источники:
- https://support.kontur.ru/ca/38813-ustanovka_kriptopro_csp_na_altlinux


## Вход с помощью токена на Госуслугах


1. Установить расширение для браузера [Google Chrome/Chromium/Chromium GOST/Спутник/Яндекс.Браузер/Opera](https://chrome.google.com/webstore/detail/ifcplugin-extension/pbefkdcndngodfeigfdgiodgnmbgcfha) или [Mozilla Firefox](https://ds-plugin.gosuslugi.ru/plugin/upload/assets/distrib/addon-1.2.8-fx.xpi)

2. Проверьте, что расширение включено в браузере, на сайте [Госуслуг](https://www.gosuslugi.ru/) расширение должно быть цветным и включенным, если нет, проверьте настройки расширений 
![Цветное расширение в меню расширений следующий после строчки адреса сайта обычно, для проверки работы: находясь на сайте госуслуг, нажмите ПКМ на Расширение для плагина Госуслуг, второй пункт сверху в меню должен быть - расширение может получать доступ к данным сайта и изменять их](/cryptopro/ext-is-on.png)

3. Установите плагин для работы с порталом государственных услуг [IFCPlugin.rpm](https://ds-plugin.gosuslugi.ru/plugin/upload/assets/distrib/IFCPlugin-x86_64.rpm) ([Источник: п.2 установки, x64-rpm](https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/275))

4. Загрузить файл конфигурации [ifcx64.cfg](https://www.cryptopro.ru/sites/default/files/public/faq/ifcx64.cfg) ([Источник: п.3 установки, x64](https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/275))

5. Откройте папку где сохранился `ifcx64.cfg`, откройте терминал "ПКМ" → "Открыть терминал" и выполните команду
```shell
sudo cp ~/ifcx86.cfg /etc/ifc.cfg
```

6. На данном этапе можно уже проверить вход на госуслугах с помощью вашего токена на странице входа на портал [Госуслуг](https://esia.gosuslugi.ru/login):
    - нажать на ссылку Войти с электронной подписью,
    - нажать на кнопку Готово,
    - выбрать нужный сертификат электронной подписи,
    - в окне Ввод пин-кода ввести любое значение (оно на данном этапе не проверяется) и нажать кнопку Продолжить,
    - при возникновении окна КриптоПро CSP ввести пин-код для ключевого контейнера в поле Пароль: и нажать кнопку OK.


7. При возникновении проблем для Chromium/Спутник/Яндекс.Браузер также может быть необходимо выполнить в терминале команду:
```shell
sudo cp /etc/opt/chrome/native-messaging-hosts/ru.rtlabs.ifcplugin.json /etc/chromium/native-messaging-hosts
```


### Пробуем решать проблемы:
1. Ошибка "Электронная подпись не найдена" - значит есть проблемы с установкой файла `ifcx64.cfg` повторите действие из пункта 4
![Ошибка на портале Госуслуги: Электронная подпись не найдена](/cryptopro/sing404.jpg)


Источники:
- КриптоПро https://support.cryptopro.ru/index.php?/Knowledgebase/Article/View/275
- Госуслуги https://ds-plugin.gosuslugi.ru/plugin/upload/Index.spr